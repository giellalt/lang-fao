## Include this file in top-level srcdir to compile FSTs
## Copyright: SÃ¡mediggi/Divvun/UiT
## Licence: GPL v3+

# This file is included by $GTLANG/am-shared/src-dir-include.am, which is
# included by $GTLANG/src/Makefile.am. All file references are relative to
# that Makefile.am.

# analyser-oahpa-gt-desc
# Require:
# * homonym tags: Hom1, Hom2 (ie don't remove)  - done
# Optionally allow these tags:
# * transitivity tags: IV, TV,                  - done
# * variant tags: v1, v2, v3, v4, v5,           - done
# * generation restriction tags: Use/NGminip    - not implemented

# Build the general descriptive Oahpa analyser:
analyser-oahpa-gt-desc.tmp.hfst: generator-raw-gt-desc.hfst      \
					filters/remove-derivation-position-tags.hfst \
					filters/remove-dialect-tags.hfst             \
					filters/remove-norm-comp-tags.hfst           \
					filters/remove-orig_lang-tags.hfst           \
					filters/remove-usage-tags.hfst               \
					filters/remove-semantic-tags.hfst            \
					filters/remove-hyphenation-marks.hfst        \
					filters/remove-infl_deriv-borders.hfst       \
					filters/remove-word-boundary.hfst            \
					filters/remove-orthography-tags.hfst         \
					filters/remove-Orth_IPA-strings.hfst         \
					orthography/inituppercase.hfst               \
					orthography/spellrelax.hfst                  \
					orthography/downcase-derived_proper-strings.hfst
	$(AM_V_HXFST)$(PRINTF) "set xerox-composition ON \n\
			read regex \
				@\"filters/remove-derivation-position-tags.hfst\" \
			.o. @\"filters/remove-dialect-tags.hfst\"             \
			.o. @\"filters/remove-norm-comp-tags.hfst\"           \
			.o. @\"filters/remove-orig_lang-tags.hfst\"           \
			.o. @\"filters/remove-usage-tags.hfst\"               \
			.o. @\"filters/remove-semantic-tags.hfst\"            \
			.o. @\"filters/remove-orthography-tags.hfst\"         \
			.o. @\"filters/remove-Orth_IPA-strings.hfst\"         \
			.o. @\"$<\"                                           \
			.o. @\"orthography/downcase-derived_proper-strings.hfst\" \
			.o. @\"filters/remove-hyphenation-marks.hfst\"        \
			.o. @\"filters/remove-infl_deriv-borders.hfst\"       \
			.o. @\"filters/remove-word-boundary.hfst\"            \
			; \n\
			define fst \n\
			set flag-is-epsilon ON\n\
			read regex fst \
			.o. @\"orthography/inituppercase.hfst\"               \
			.o. @\"orthography/spellrelax.hfst\"                  \
			;\n\
		 save stack $@\n\
		 quit\n" | $(HFST_XFST) $(VERBOSITY)

analyser-oahpa-gt-desc.tmp.xfst: analyser-raw-gt-desc.xfst        \
					filters/remove-derivation-position-tags.xfst \
					filters/remove-dialect-tags.xfst             \
					filters/remove-norm-comp-tags.xfst           \
					filters/remove-orig_lang-tags.xfst           \
					filters/remove-usage-tags.xfst               \
					filters/remove-semantic-tags.xfst            \
					filters/remove-hyphenation-marks.xfst        \
					filters/remove-infl_deriv-borders.xfst       \
					filters/remove-word-boundary.xfst            \
					filters/remove-orthography-tags.xfst         \
					filters/remove-Orth_IPA-strings.xfst         \
					orthography/inituppercase.xfst               \
					orthography/spellrelax.xfst                  \
					orthography/downcase-derived_proper-strings.xfst
	$(AM_V_XFST)$(PRINTF) "read regex \
				@\"filters/remove-derivation-position-tags.xfst\" \
			.o. @\"filters/remove-dialect-tags.xfst\"             \
			.o. @\"filters/remove-norm-comp-tags.xfst\"           \
			.o. @\"filters/remove-orig_lang-tags.xfst\"           \
			.o. @\"filters/remove-usage-tags.xfst\"               \
			.o. @\"filters/remove-semantic-tags.xfst\"            \
			.o. @\"filters/remove-orthography-tags.xfst\"         \
			.o. @\"filters/remove-Orth_IPA-strings.xfst\"         \
			.o. @\"$<\" \
			.o. @\"orthography/downcase-derived_proper-strings.xfst\" \
			.o. @\"filters/remove-hyphenation-marks.xfst\"        \
			.o. @\"filters/remove-infl_deriv-borders.xfst\"       \
			.o. @\"filters/remove-word-boundary.xfst\"            \
			; \n\
			define fst \n\
			set flag-is-epsilon ON\n\
			read regex fst \
			.o. @\"orthography/inituppercase.xfst\"               \
			.o. @\"orthography/spellrelax.xfst\"                  \
			;\n\
		 save stack $@\n\
		 quit\n" | $(XFST) $(VERBOSITY)


# oahpa-norm / generator-oahpa-gt-norm
# Require:
# * homonym tags: Hom1, Hom2 (ie don't remove)  - done
# Optionally allow these tags:
# * transitivity tags: IV, TV,                  - done
# * variant tags: v1, v2, v3, v4, v5,           - done
# * generation restriction tags: Use/NGminip    - not implemented

# Build the general normative Oahpa generator:
generator-oahpa-gt-norm.tmp.hfst: generator-raw-gt-desc.hfst     \
					filters/make-optional-transitivity-tags.hfst \
					filters/make-optional-variant-tags.hfst      \
					filters/make-optional-semantic-tags.hfst     \
					filters/remove-derivation-position-tags.hfst \
					filters/remove-dialect-tags.hfst             \
					filters/remove-hyphenation-marks.hfst        \
					filters/remove-infl_deriv-borders.hfst       \
					filters/remove-word-boundary.hfst            \
					filters/remove-norm-comp-tags.hfst           \
					filters/remove-number-string-tags.hfst       \
					filters/remove-usage-tags.hfst               \
					filters/remove-orthography-tags.hfst         \
					filters/remove-Orth_IPA-strings.hfst         \
					filters/remove-sub-forms.hfst                \
					orthography/downcase-derived_proper-strings.hfst
	$(AM_V_HXFST)$(PRINTF) "set xerox-composition ON \n\
			read regex \
				@\"filters/make-optional-transitivity-tags.hfst\" \
			.o. @\"filters/make-optional-variant-tags.hfst\"      \
			.o. @\"filters/make-optional-semantic-tags.hfst\"     \
			.o. @\"filters/remove-derivation-position-tags.hfst\" \
			.o. @\"filters/remove-dialect-tags.hfst\"             \
			.o. @\"filters/remove-norm-comp-tags.hfst\"           \
			.o. @\"filters/remove-number-string-tags.hfst\"       \
			.o. @\"filters/remove-usage-tags.hfst\"               \
			.o. @\"filters/remove-sub-forms.hfst\"                \
			.o. @\"filters/remove-orthography-tags.hfst\"         \
			.o. @\"filters/remove-Orth_IPA-strings.hfst\"         \
			.o. @\"$<\"                                           \
			.o. @\"orthography/downcase-derived_proper-strings.hfst\" \
			.o. @\"filters/remove-hyphenation-marks.hfst\"        \
			.o. @\"filters/remove-infl_deriv-borders.hfst\"       \
			.o. @\"filters/remove-word-boundary.hfst\"            \
			;\n\
		 save stack $@\n\
		 quit\n" | $(HFST_XFST) $(VERBOSITY)

generator-oahpa-gt-norm.tmp.xfst: analyser-raw-gt-desc.xfst      \
					filters/make-optional-transitivity-tags.xfst \
					filters/make-optional-variant-tags.xfst      \
					filters/make-optional-semantic-tags.xfst     \
					filters/remove-derivation-position-tags.xfst \
					filters/remove-dialect-tags.xfst             \
					filters/remove-hyphenation-marks.xfst        \
					filters/remove-infl_deriv-borders.xfst       \
					filters/remove-word-boundary.xfst            \
					filters/remove-norm-comp-tags.xfst           \
					filters/remove-number-string-tags.xfst       \
					filters/remove-usage-tags.xfst               \
					filters/remove-orthography-tags.xfst         \
					filters/remove-Orth_IPA-strings.xfst         \
					filters/remove-sub-forms.xfst                \
					orthography/downcase-derived_proper-strings.xfst
	$(AM_V_XFST)$(PRINTF)                             "read regex \
				@\"filters/make-optional-transitivity-tags.xfst\" \
			.o. @\"filters/make-optional-variant-tags.xfst\"      \
			.o. @\"filters/make-optional-semantic-tags.xfst\"     \
			.o. @\"filters/remove-derivation-position-tags.xfst\" \
			.o. @\"filters/remove-dialect-tags.xfst\"             \
			.o. @\"filters/remove-norm-comp-tags.xfst\"           \
			.o. @\"filters/remove-number-string-tags.xfst\"       \
			.o. @\"filters/remove-usage-tags.xfst\"               \
			.o. @\"filters/remove-sub-forms.xfst\"                \
			.o. @\"filters/remove-orthography-tags.xfst\"         \
			.o. @\"filters/remove-Orth_IPA-strings.xfst\"         \
			.o. @\"$<\"                                           \
			.o. @\"orthography/downcase-derived_proper-strings.xfst\" \
			.o. @\"filters/remove-hyphenation-marks.xfst\"        \
			.o. @\"filters/remove-infl_deriv-borders.xfst\"       \
			.o. @\"filters/remove-word-boundary.xfst\"            \
			;\n\
		 invert net\n\
		 save stack $@\n\
		 quit\n" | $(XFST) $(VERBOSITY)


if HAVE_DIALECTS

DIALECT_TARGETS=$(addprefix generator-oahpa-gt-norm-dial_,$(DIALECTS))
DIALECT_TARGETS_XFST=$(addsuffix .xfst,$(DIALECT_TARGETS))
DIALECT_TARGETS_HFST=$(addsuffix .hfst,$(DIALECT_TARGETS))

endif # HAVE_DIALECTS

# Build the dialect-targeted normative Oahpa generator -
# the dialects are defined in configure.ac:
generator-oahpa-gt-norm-dial_%.hfst: generator-raw-gt-desc.hfst    \
					filters/remove-all_dialects_but_%-strings.hfst \
					filters/make-optional-transitivity-tags.hfst   \
					filters/make-optional-variant-tags.hfst        \
					filters/make-optional-semantic-tags.hfst       \
					filters/remove-derivation-position-tags.hfst   \
					filters/remove-dialect-tags.hfst               \
					filters/remove-hyphenation-marks.hfst          \
					filters/remove-infl_deriv-borders.hfst         \
					filters/remove-word-boundary.hfst              \
					filters/remove-norm-comp-tags.hfst             \
					filters/remove-number-string-tags.hfst         \
					filters/remove-usage-tags.hfst                 \
					filters/remove-orthography-tags.hfst           \
					filters/remove-Orth_IPA-strings.hfst           \
					filters/remove-NG-strings.hfst                 \
					filters/remove-sub-forms.hfst                  \
					orthography/downcase-derived_proper-strings.hfst
	$(AM_V_HXFST)$(PRINTF) "set xerox-composition ON \n\
			read regex \
				@\"filters/make-optional-transitivity-tags.hfst\"    \
			.o. @\"filters/make-optional-variant-tags.hfst\"         \
			.o. @\"filters/make-optional-semantic-tags.hfst\"        \
			.o. @\"filters/remove-derivation-position-tags.hfst\"    \
			.o. @\"filters/remove-dialect-tags.hfst\"                \
			.o. @\"filters/remove-norm-comp-tags.hfst\"              \
			.o. @\"filters/remove-number-string-tags.hfst\"          \
			.o. @\"filters/remove-usage-tags.hfst\"                  \
			.o. @\"filters/remove-sub-forms.hfst\"                   \
			.o. @\"filters/remove-orthography-tags.hfst\"            \
			.o. @\"filters/remove-Orth_IPA-strings.hfst\"            \
			.o. @\"filters/remove-NG-strings.hfst\"                  \
			.o. @\"filters/remove-all_dialects_but_$*-strings.hfst\" \
			.o. @\"$<\"                                              \
			.o. @\"orthography/downcase-derived_proper-strings.hfst\" \
			.o. @\"filters/remove-hyphenation-marks.hfst\"        \
			.o. @\"filters/remove-infl_deriv-borders.hfst\"       \
			.o. @\"filters/remove-word-boundary.hfst\"            \
			;\n\
		 save stack $@\n\
		 quit\n" | $(HFST_XFST) $(VERBOSITY)

generator-oahpa-gt-norm-dial_%.xfst: analyser-raw-gt-desc.xfst     \
					filters/remove-all_dialects_but_%-strings.xfst \
					filters/make-optional-transitivity-tags.xfst   \
					filters/make-optional-variant-tags.xfst        \
					filters/make-optional-semantic-tags.xfst       \
					filters/remove-derivation-position-tags.xfst   \
					filters/remove-dialect-tags.xfst               \
					filters/remove-hyphenation-marks.xfst          \
					filters/remove-infl_deriv-borders.xfst         \
					filters/remove-word-boundary.xfst              \
					filters/remove-norm-comp-tags.xfst             \
					filters/remove-number-string-tags.xfst         \
					filters/remove-usage-tags.xfst                 \
					filters/remove-orthography-tags.xfst           \
					filters/remove-Orth_IPA-strings.xfst           \
					filters/remove-NG-strings.xfst                 \
					filters/remove-sub-forms.xfst                  \
					orthography/downcase-derived_proper-strings.xfst
	$(AM_V_XFST)$(PRINTF)                                "read regex \
				@\"filters/make-optional-transitivity-tags.xfst\"    \
			.o. @\"filters/make-optional-variant-tags.xfst\"         \
			.o. @\"filters/make-optional-semantic-tags.xfst\"        \
			.o. @\"filters/remove-derivation-position-tags.xfst\"    \
			.o. @\"filters/remove-dialect-tags.xfst\"                \
			.o. @\"filters/remove-norm-comp-tags.xfst\"              \
			.o. @\"filters/remove-number-string-tags.xfst\"          \
			.o. @\"filters/remove-usage-tags.xfst\"                  \
			.o. @\"filters/remove-sub-forms.xfst\"                   \
			.o. @\"filters/remove-orthography-tags.xfst\"            \
			.o. @\"filters/remove-Orth_IPA-strings.xfst\"            \
			.o. @\"filters/remove-NG-strings.xfst\"                  \
			.o. @\"filters/remove-all_dialects_but_$*-strings.xfst\" \
			.o. @\"$<\"                                              \
			.o. @\"orthography/downcase-derived_proper-strings.xfst\" \
			.o. @\"filters/remove-hyphenation-marks.xfst\"           \
			.o. @\"filters/remove-infl_deriv-borders.xfst\"          \
			.o. @\"filters/remove-word-boundary.xfst\"               \
			;\n\
		 invert net\n\
		 save stack $@\n\
		 quit\n" | $(XFST) $(VERBOSITY)
